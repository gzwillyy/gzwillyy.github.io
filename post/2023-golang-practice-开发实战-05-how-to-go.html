<!doctypehtml><html lang=zh-CN><meta charset=UTF-8><meta content=width=device-width name=viewport><meta content=#222 name=theme-color><meta content="Hexo 6.3.0" name=generator><link href=/images/apple-touch-icon-next.png rel=apple-touch-icon sizes=180x180><link href=/images/favicon-32x32-next.png rel=icon sizes=32x32 type=image/png><link href=/images/favicon-16x16-next.png rel=icon sizes=16x16 type=image/png><link color=#222 href=/images/logo.svg rel=mask-icon><style>:root{--body-bg-color:#f5f7f9;--content-bg-color:#fff;--card-bg-color:#f5f5f5;--text-color:#555;--blockquote-color:#666;--link-color:#555;--link-hover-color:#222;--brand-color:#fff;--brand-hover-color:#fff;--table-row-odd-bg-color:#f9f9f9;--table-row-hover-bg-color:#f5f5f5;--menu-item-bg-color:#f5f5f5;--theme-color:#222;--btn-default-bg:#fff;--btn-default-color:#555;--btn-default-border-color:#555;--btn-default-hover-bg:#222;--btn-default-hover-color:#fff;--btn-default-hover-border-color:#222;--highlight-background:#f3f3f3;--highlight-foreground:#444;--highlight-gutter-background:#e1e1e1;--highlight-gutter-foreground:#555;color-scheme:light}html{line-height:1.15;-webkit-text-size-adjust:100%}details,main{display:block}pre{font-size:1em;overflow:auto;padding:10px;position:relative}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:ButtonText dotted 1px}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}.table-container,textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}summary{display:list-item}[hidden],template{display:none}::selection{background:#262a30;color:#eee}body,html{height:100%}body{margin:0;background:var(--body-bg-color);box-sizing:border-box;color:var(--text-color);font-family:EB Garamond,'Noto Serif SC','PingFang SC','Microsoft YaHei',sans-serif;font-size:1em;line-height:2;min-height:100%;position:relative;transition:padding .2s ease-in-out}h1,h2,h3,h4,h5,h6{font-family:EB Garamond,'Noto Serif SC','PingFang SC','Microsoft YaHei',sans-serif;font-weight:700;line-height:1.5;margin:30px 0 15px}h1{font-size:1.5em}h2{font-size:1.375em}h3{font-size:1.25em}h4{font-size:1.125em}h5{font-size:1em}h6{font-size:.875em}p{margin:0 0 20px}a{background:0 0;border-bottom:1px solid #999;color:var(--link-color);cursor:pointer;outline:0;text-decoration:none;overflow-wrap:break-word}a:hover{border-bottom-color:var(--link-hover-color);color:var(--link-hover-color)}embed,iframe,img,video{display:block;margin-left:auto;margin-right:auto;max-width:100%}hr{box-sizing:content-box;overflow:visible;background-image:repeating-linear-gradient(-45deg,#ddd,#ddd 4px,transparent 4px,transparent 8px);border:0;height:3px;margin:40px 0}blockquote{border-left:4px solid #ddd;color:var(--blockquote-color);margin:0;padding:0 15px}blockquote cite::before{content:'-';padding:0 5px}dt{font-weight:700}dd{margin:0;padding:0}table{border-collapse:collapse;border-spacing:0;font-size:.875em;margin:0 0 20px;width:100%}tbody tr:nth-of-type(odd){background:var(--table-row-odd-bg-color)}tbody tr:hover{background:var(--table-row-hover-bg-color)}caption,td,th{padding:8px}td,th{border:1px solid #ddd;border-bottom:3px solid #ddd}th{font-weight:700;padding-bottom:10px}td{border-bottom-width:1px}.btn{background:var(--btn-default-bg);border:2px solid var(--btn-default-border-color);border-radius:2px;color:var(--btn-default-color);display:inline-block;font-size:.875em;line-height:2;padding:0 20px;transition:background-color .2s ease-in-out}.btn:hover{background:var(--btn-default-hover-bg);border-color:var(--btn-default-hover-border-color);color:var(--btn-default-hover-color)}.btn+.btn{margin:0 0 8px 8px}.btn .fa-fw{text-align:left;width:1.285714285714286em}.toggle{line-height:0}.toggle .toggle-line{background:#fff;display:block;height:2px;left:0;position:relative;top:0;transition:.4s;width:100%}.toggle .toggle-line:first-child{margin-top:1px}.toggle .toggle-line:not(:first-child){margin-top:4px}.toggle.toggle-arrow :first-child{left:50%;top:2px;transform:rotate(45deg);width:50%}.toggle.toggle-arrow :last-child{left:50%;top:-2px;transform:rotate(-45deg);width:50%}.toggle.toggle-close :nth-child(2){opacity:0}.toggle.toggle-close :first-child{top:6px;transform:rotate(45deg)}.toggle.toggle-close :last-child{top:-6px;transform:rotate(-45deg)}code[class*=language-],pre[class*=language-]{color:#000;background:0 0;text-shadow:0 1px #fff;font-family:Consolas,Monaco,'Andale Mono','Ubuntu Mono',monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-] ::-moz-selection,code[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection{text-shadow:none;background:#b3d4fc}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}pre[class*=language-].line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}pre[class*=language-].line-numbers>code{position:relative;white-space:inherit}.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:0;font-size:100%;left:-3.8em;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.line-numbers-rows>span{display:block;counter-increment:linenumber}.line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.highlight:hover .copy-btn,pre:hover .copy-btn{opacity:1}figure.highlight .table-container{position:relative}.copy-btn{color:#333;cursor:pointer;line-height:1.6;opacity:0;padding:2px 6px;position:absolute;transition:opacity .2s ease-in-out;background-color:#eee;background-image:linear-gradient(#fcfcfc,#eee);border:1px solid #d5d5d5;border-radius:3px;font-size:.8125em;right:4px;top:8px}code,figure.highlight,kbd,pre{background:var(--highlight-background);color:var(--highlight-foreground)}figure.highlight,pre{line-height:1.6;margin:0 auto 20px}figure.highlight figcaption,pre .caption,pre figcaption{background:var(--highlight-gutter-background);color:var(--highlight-foreground);display:flow-root;font-size:.875em;line-height:1.2;padding:.5em}figure.highlight figcaption a,pre .caption a,pre figcaption a{color:var(--highlight-foreground);float:right}figure.highlight figcaption a:hover,pre .caption a:hover,pre figcaption a:hover{border-bottom-color:var(--highlight-foreground)}code,pre{font-family:JetBrains Mono,consolas,Menlo,monospace,'PingFang SC','Microsoft YaHei'}code{border-radius:3px;font-size:.875em;padding:2px 4px;overflow-wrap:break-word}kbd{border:2px solid #ccc;border-radius:.2em;box-shadow:.1em .1em .2em rgba(0,0,0,.1);font-family:inherit;padding:.1em .3em;white-space:nowrap}figure.highlight{overflow:auto;position:relative}figure.highlight pre{border:0;margin:0;padding:10px 0}figure.highlight table{border:0;margin:0;width:auto}figure.highlight td{border:0;padding:0}figure.highlight .gutter{-moz-user-select:none;-ms-user-select:none;-webkit-user-select:none;user-select:none}figure.highlight .gutter pre{background:var(--highlight-gutter-background);color:var(--highlight-gutter-foreground);padding-left:10px;padding-right:10px;text-align:right}figure.highlight .code pre{padding-left:10px;width:100%}figure.highlight .marked{background:rgba(0,0,0,.3)}pre .caption,pre figcaption{margin-bottom:10px}.gist table{width:auto}.gist table td{border:0}pre code{background:0 0;padding:0;text-shadow:none}.blockquote-center{border-left:0;margin:40px 0;padding:0;position:relative;text-align:center}.blockquote-center::after,.blockquote-center::before{left:0;line-height:1;opacity:.6;position:absolute;width:100%}.blockquote-center::before{border-top:1px solid #ccc;text-align:left;top:-20px;content:'\f10d';font-family:'Font Awesome 6 Free';font-weight:900}.blockquote-center::after{border-bottom:1px solid #ccc;bottom:-20px;text-align:right;content:'\f10e';font-family:'Font Awesome 6 Free';font-weight:900}.blockquote-center div,.blockquote-center p{text-align:center}.group-picture{margin-bottom:20px}.group-picture .group-picture-row{display:flex;gap:3px;margin-bottom:3px}.group-picture .group-picture-column{flex:1}.group-picture .group-picture-column img{height:100%;margin:0;object-fit:cover;width:100%}.post-body .label{color:#555;padding:0 2px}.post-body .label.default{background:#f0f0f0}.post-body .label.primary{background:#efe6f7}.post-body .label.info{background:#e5f2f8}.post-body .label.success{background:#e7f4e9}.post-body .label.warning{background:#fcf6e1}.post-body .label.danger{background:#fae8eb}.post-body .link-grid{display:grid;grid-gap:1.5rem;gap:1.5rem;grid-template-columns:1fr 1fr;margin-bottom:20px;padding:1rem}.post-body .link-grid .link-grid-container{border:solid #ddd;box-shadow:1rem 1rem .5rem rgba(0,0,0,.5);min-height:5rem;min-width:0;padding:.5rem;position:relative;transition:background .3s}.post-body .link-grid .link-grid-container:hover{animation:.5s next-shake;background:var(--card-bg-color)}.post-body .link-grid .link-grid-container:active{box-shadow:.5rem .5rem .25rem rgba(0,0,0,.5);transform:translate(.2rem,.2rem)}.post-body .link-grid .link-grid-container .link-grid-image{border:1px solid #ddd;border-radius:50%;box-sizing:border-box;height:5rem;padding:3px;position:absolute;width:5rem}.post-body .link-grid .link-grid-container p{margin:0 1rem 0 6rem}.post-body .link-grid .link-grid-container p:first-of-type{font-size:1.2em}.post-body .link-grid .link-grid-container p:last-of-type{font-size:.8em;line-height:1.3rem;opacity:.7}.post-body .link-grid .link-grid-container a{border:0;height:100%;left:0;position:absolute;top:0;width:100%}@keyframes next-shake{0%{transform:translate(1pt,1pt) rotate(0)}10%{transform:translate(-1pt,-2pt) rotate(-1deg)}20%{transform:translate(-3pt,0) rotate(1deg)}30%{transform:translate(3pt,2pt) rotate(0)}40%{transform:translate(1pt,-1pt) rotate(1deg)}50%{transform:translate(-1pt,2pt) rotate(-1deg)}60%{transform:translate(-3pt,1pt) rotate(0)}70%{transform:translate(3pt,1pt) rotate(-1deg)}80%{transform:translate(-1pt,-1pt) rotate(1deg)}90%{transform:translate(1pt,2pt) rotate(0)}100%{transform:translate(1pt,-2pt) rotate(-1deg)}}.post-body .note{border-radius:3px;margin-bottom:20px;padding:1em;position:relative;border:1px solid #eee;border-left-width:5px}.post-body .note summary{cursor:pointer;outline:0}.post-body .note summary p{display:inline}.post-body .note h2,.post-body .note h3,.post-body .note h4,.post-body .note h5,.post-body .note h6{border-bottom:initial;margin:0;padding-top:0}.post-body .note :first-child{margin-top:0}.post-body .note :last-child{margin-bottom:0}.post-body .note.default{border-left-color:#777}.post-body .note.default h2,.post-body .note.default h3,.post-body .note.default h4,.post-body .note.default h5,.post-body .note.default h6{color:#777}.post-body .note.primary{border-left-color:#6f42c1}.post-body .note.primary h2,.post-body .note.primary h3,.post-body .note.primary h4,.post-body .note.primary h5,.post-body .note.primary h6{color:#6f42c1}.post-body .note.info{border-left-color:#428bca}.post-body .note.info h2,.post-body .note.info h3,.post-body .note.info h4,.post-body .note.info h5,.post-body .note.info h6{color:#428bca}.post-body .note.success{border-left-color:#5cb85c}.post-body .note.success h2,.post-body .note.success h3,.post-body .note.success h4,.post-body .note.success h5,.post-body .note.success h6{color:#5cb85c}.post-body .note.warning{border-left-color:#f0ad4e}.post-body .note.warning h2,.post-body .note.warning h3,.post-body .note.warning h4,.post-body .note.warning h5,.post-body .note.warning h6{color:#f0ad4e}.post-body .note.danger{border-left-color:#d9534f}.post-body .note.danger h2,.post-body .note.danger h3,.post-body .note.danger h4,.post-body .note.danger h5,.post-body .note.danger h6{color:#d9534f}.post-body .tabs{margin-bottom:20px}.post-body .tabs,.tabs-comment{padding-top:10px}.post-body .tabs ul.nav-tabs,.tabs-comment ul.nav-tabs{background:var(--content-bg-color);display:flex;display:flex;flex-wrap:wrap;justify-content:center;margin:0;padding:0;position:-webkit-sticky;position:sticky;top:0;z-index:5}.post-body .tabs ul.nav-tabs li.tab,.tabs-comment ul.nav-tabs li.tab{border-bottom:1px solid #ddd;border-left:1px solid transparent;border-right:1px solid transparent;border-radius:0;border-top:3px solid transparent;flex-grow:1;list-style-type:none}@media (max-width:413px){.post-body .tabs ul.nav-tabs,.tabs-comment ul.nav-tabs{display:block;margin-bottom:5px}.post-body .tabs ul.nav-tabs li.tab,.tabs-comment ul.nav-tabs li.tab{border-bottom:1px solid transparent;border-left:3px solid transparent;border-right:1px solid transparent;border-top:1px solid transparent;border-radius:0}}.post-body .tabs ul.nav-tabs li.tab a,.tabs-comment ul.nav-tabs li.tab a{border-bottom:initial;display:block;line-height:1.8;padding:.25em .75em;text-align:center;transition:.2s ease-out}.post-body .tabs ul.nav-tabs li.tab a i,.tabs-comment ul.nav-tabs li.tab a i{width:1.285714285714286em}.post-body .tabs ul.nav-tabs li.tab.active,.tabs-comment ul.nav-tabs li.tab.active{border-color:#fc6423 #ddd transparent}@media (max-width:413px){.post-body .tabs ul.nav-tabs li.tab.active,.tabs-comment ul.nav-tabs li.tab.active{border-color:#ddd #ddd #ddd #fc6423}}.post-body .tabs ul.nav-tabs li.tab.active a,.tabs-comment ul.nav-tabs li.tab.active a{cursor:default}.post-body .tabs .tab-content,.tabs-comment .tab-content{border:1px solid #ddd;border-radius:0;border-top-color:transparent}@media (max-width:413px){.post-body .tabs .tab-content,.tabs-comment .tab-content{border-radius:0;border-top-color:#ddd}}.post-body .tabs .tab-content .tab-pane,.tabs-comment .tab-content .tab-pane{padding:20px 20px 0}.post-body .tabs .tab-content .tab-pane:not(.active),.tabs-comment .tab-content .tab-pane:not(.active){display:none}.pagination .next,.pagination .page-number,.pagination .prev,.pagination .space{display:inline-block;margin:-1px 10px 0;padding:0 10px}.pagination .page-number.current{background:#ccc;border-color:#ccc;color:var(--content-bg-color)}.pagination{border-top:1px solid #eee;margin:120px 0 0;text-align:center}.pagination .next,.pagination .page-number,.pagination .prev{border-bottom:0;border-top:1px solid #eee;transition:border-color .2s ease-in-out}.pagination .next:hover,.pagination .page-number:hover,.pagination .prev:hover{border-top-color:var(--link-hover-color)}@media (max-width:767px){.post-body .link-grid{grid-template-columns:1fr}.pagination .next,.pagination .page-number,.pagination .prev,.pagination .space{margin:0 5px}.pagination{border-top:0}.pagination .next,.pagination .page-number,.pagination .prev{border-bottom:1px solid #eee;border-top:0}.pagination .next:hover,.pagination .page-number:hover,.pagination .prev:hover{border-bottom-color:var(--link-hover-color)}.site-meta{text-align:center}}.pagination .space{margin:0;padding:0}.comments{margin-top:60px;overflow:hidden}.comment-button-group{display:flex;display:flex;flex-wrap:wrap;justify-content:center;justify-content:center;margin:1em 0}.comment-button-group .comment-button{margin:.1em .2em}.comment-button-group .comment-button.active{background:var(--btn-default-hover-bg);border-color:var(--btn-default-hover-border-color);color:var(--btn-default-hover-color)}.comment-position{display:none}.comment-position.active{display:block}.tabs-comment{margin-top:4em;padding-top:0}.tabs-comment .comments{margin-top:0;padding-top:0}.headband{background:var(--theme-color);height:3px}@media (max-width:991px){.headband{display:none}}.site-brand-container{display:flex;flex-shrink:0;padding:0 10px}.use-motion .column,.use-motion .site-brand-container .toggle{opacity:0}.site-meta{flex-grow:1;text-align:center}.custom-logo-image{margin-top:20px}@media (max-width:991px){.custom-logo-image{display:none}}.brand{border-bottom:0;color:var(--brand-color);display:inline-block;padding:0}.brand:hover{color:var(--brand-hover-color)}.site-title{font-family:Cinzel Decorative,EB Garamond,'Noto Serif SC','PingFang SC','Microsoft YaHei',sans-serif;font-size:1.375em;font-weight:400;line-height:1.5;margin:0}.site-subtitle{color:#ddd;font-size:.8125em;margin:10px 10px 0}.use-motion .custom-logo-image,.use-motion .site-subtitle,.use-motion .site-title{opacity:0;position:relative;top:-10px}.site-nav-right,.site-nav-toggle{display:none}.site-nav-right .toggle,.site-nav-toggle .toggle{color:var(--text-color);padding:10px;width:22px}.site-nav-right .toggle .toggle-line,.site-nav-toggle .toggle .toggle-line{background:var(--text-color);border-radius:1px}@media (max-width:767px){.site-nav-right,.site-nav-toggle{display:flex;flex-direction:column;justify-content:center}.site-nav{--scroll-height:0;height:0;overflow:hidden;transition:height .2s ease-in-out}body:not(.site-nav-on) .site-nav .animated{animation:none}body.site-nav-on .site-nav{height:var(--scroll-height)}}.menu{margin:0;padding:1em 0;text-align:center}.menu-item{display:inline-block;list-style:none;margin:0 10px}@media (max-width:767px){.menu-item{display:block;margin-top:10px}.menu-item.menu-item-search{display:none}}.menu-item a{border-bottom:0;display:block;font-size:.8125em;transition:border-color .2s ease-in-out}.menu-item a.menu-item-active,.menu-item a:hover{background:var(--menu-item-bg-color)}.menu-item .fa,.menu-item .fab,.menu-item .far,.menu-item .fas{margin-right:8px}.menu-item .badge{display:inline-block;font-weight:700;line-height:1;margin-left:.35em;margin-top:.35em;text-align:center;white-space:nowrap}.use-motion .menu-item{visibility:hidden}.sidebar-inner{color:#999;padding:18px 10px;text-align:center;display:flex;flex-direction:column;justify-content:center}.cc-license .cc-opacity{border-bottom:0;opacity:.7}.cc-license .cc-opacity:hover{opacity:.9}.cc-license img{display:inline-block}.site-author-image{border:1px solid #eee;max-width:120px;padding:2px}.site-author-name{color:var(--text-color);font-weight:600;margin:0}.site-description{color:#999;font-size:.8125em;margin-top:0}.links-of-author a{font-size:.8125em}.links-of-author .fa,.links-of-author .fab,.links-of-author .far,.links-of-author .fas{margin-right:2px}.sidebar .sidebar-button:not(:first-child){margin-top:15px}.sidebar .sidebar-button button{background:0 0;cursor:pointer;line-height:2;padding:0 15px;border-radius:4px}.sidebar .sidebar-button button .fa,.sidebar .sidebar-button button .fab,.sidebar .sidebar-button button .far,.sidebar .sidebar-button button .fas{margin-right:5px}.links-of-blogroll{font-size:.8125em}.links-of-blogroll-title{font-size:.875em;font-weight:600}.links-of-blogroll-list{list-style:none;margin:0;padding:0}.sidebar-nav{display:none;margin:0;padding-bottom:20px;padding-left:0}.sidebar-nav-active .sidebar-nav{display:block}.sidebar-nav li{border-bottom:1px solid transparent;color:var(--text-color);cursor:pointer;display:inline-block;font-size:.875em}.sidebar-nav li.sidebar-nav-overview{margin-left:10px}.sidebar-nav li:hover{color:#fc6423}.sidebar-overview-active .sidebar-nav-overview,.sidebar-toc-active .sidebar-nav-toc{border-bottom-color:#fc6423;color:#fc6423}.sidebar-overview-active .sidebar-nav-overview:hover,.sidebar-toc-active .sidebar-nav-toc:hover{color:#fc6423}.sidebar-panel-container{flex:1;overflow-x:hidden;overflow-y:auto}.sidebar-panel{display:none}.sidebar-overview-active .site-overview-wrap{display:flex;flex-direction:column;justify-content:center;gap:10px}.sidebar-toc-active .post-toc-wrap{display:block}.sidebar-toggle{bottom:61px;height:16px;padding:5px;width:16px;background:#222;cursor:pointer;opacity:.6;position:fixed;z-index:30;right:30px}.sidebar-toggle:hover{opacity:.8}@media (max-width:991px){.sidebar-toggle{right:20px;opacity:.8}}.sidebar-toggle:hover .toggle-line{background:#fc6423}@media (any-hover:hover){body:not(.sidebar-active) .sidebar-toggle:hover :first-child{left:50%;top:2px;transform:rotate(45deg);width:50%}body:not(.sidebar-active) .sidebar-toggle:hover :last-child{left:50%;top:-2px;transform:rotate(-45deg);width:50%}}.sidebar-active .sidebar-toggle :nth-child(2){opacity:0}.sidebar-active .sidebar-toggle :first-child{top:6px;transform:rotate(45deg)}.sidebar-active .sidebar-toggle :last-child{top:-6px;transform:rotate(-45deg)}.post-toc{font-size:.875em}.post-toc ol{list-style:none;margin:0;padding:0 2px 5px 10px;text-align:left}.post-toc ol>ol{padding-left:0}.post-toc ol a{transition:.2s ease-in-out}.post-toc .nav-item{line-height:1.8;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.post-toc .nav .nav-child{display:none}.post-toc .nav .active-current>.nav-child,.post-toc .nav .active-current>.nav-child>.nav-item,.post-toc .nav .active>.nav-child{display:block}.post-toc .nav .active>a{border-bottom-color:#fc6423;color:#fc6423}.post-toc .nav .active-current>a,.post-toc .nav .active-current>a:hover{color:#fc6423}.site-state{display:flex;flex-wrap:wrap;justify-content:center;line-height:1.4}.site-state-item a{border-bottom:0;display:block}.site-state-item-count{display:block;font-size:1em;font-weight:600}.site-state-item-name{color:#999;font-size:.8125em}.footer{color:#999;font-size:.875em;padding:20px 0}.footer.footer-fixed{bottom:0;left:0;position:absolute;right:0}.footer-inner{box-sizing:border-box;text-align:center;display:flex;flex-direction:column;justify-content:center;margin:0 auto;width:calc(100% - 20px)}@media (max-width:767px){.menu-item .badge{float:right;margin-left:0}.footer-inner{width:auto}}@media (min-width:1200px){.footer-inner{width:1160px}}@media (min-width:1600px){.footer-inner{width:73%}}.use-motion .footer{opacity:0}.languages{display:inline-block;font-size:1.125em;position:relative}.languages .lang-select-label span{margin:0 .5em}.languages .lang-select{height:100%;left:0;opacity:0;position:absolute;top:0;width:100%}.with-love{color:red;display:inline-block;margin:0 5px}@keyframes icon-animate{0%,100%{transform:scale(1)}10%,30%{transform:scale(.9)}20%,40%,50%,60%,70%,80%{transform:scale(1.1)}}.back-to-top{font-size:12px;align-items:center;bottom:-100px;color:#fff;display:flex;height:26px;transition:bottom .2s ease-in-out;background:#222;cursor:pointer;opacity:.6;position:fixed;z-index:30;right:30px}.back-to-top span{margin-right:8px;display:none}.back-to-top .fa{text-align:center;width:26px}.back-to-top:hover{opacity:.8;color:#fc6423}.back-to-top.back-to-top-on{bottom:30px}.rtl.post-body a,.rtl.post-body h1,.rtl.post-body h2,.rtl.post-body h3,.rtl.post-body h4,.rtl.post-body h5,.rtl.post-body h6,.rtl.post-body li,.rtl.post-body ol,.rtl.post-body p,.rtl.post-body ul{direction:rtl;font-family:UKIJ Ekran}.rtl.post-title{font-family:UKIJ Ekran}.post-button{margin-top:40px;text-align:center}.use-motion .collection-header,.use-motion .comments,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{visibility:hidden}.posts-collapse .post-content{margin-bottom:35px;margin-left:35px;position:relative}@media (max-width:767px){.posts-collapse .post-content{margin-left:0;margin-right:0}}.posts-collapse .post-content .collection-title{font-size:1.125em;position:relative}.posts-collapse .post-content .collection-title::before{background:#999;border:1px solid #fff;margin-left:-6px;margin-top:-4px;position:absolute;top:50%;border-radius:50%;content:' ';height:10px;width:10px}.posts-collapse .post-content .collection-year{font-size:1.5em;font-weight:700;margin:60px 0;position:relative}.posts-collapse .post-content .collection-year::before{background:#bbb;margin-left:-4px;margin-top:-4px;position:absolute;top:50%;border-radius:50%;content:' ';height:8px;width:8px}.posts-collapse .post-content .collection-header{display:block;margin-left:20px}.posts-collapse .post-content .collection-header small{color:#bbb;margin-left:5px}.posts-collapse .post-content .post-header{border-bottom:1px dashed #ccc;margin:30px 2px 0;padding-left:15px;position:relative;transition:border .2s ease-in-out}.posts-collapse .post-content .post-header::before{background:#bbb;border:1px solid #fff;left:-6px;position:absolute;top:.75em;transition:background .2s ease-in-out;border-radius:50%;content:' ';height:6px;width:6px}.posts-collapse .post-content .post-header:hover{border-bottom-color:#666}.posts-collapse .post-content .post-header:hover::before{background:#222}.posts-collapse .post-content .post-meta-container{display:inline;font-size:.75em;margin-right:10px}.posts-collapse .post-content .post-title{display:inline}.posts-collapse .post-content .post-title a{border-bottom:0;color:var(--link-color)}.posts-collapse .post-content .post-title .fa-external-link-alt{font-size:.875em;margin-left:5px}.posts-collapse .post-content::before{background:#f5f5f5;content:' ';height:100%;margin-left:-2px;position:absolute;top:1.25em;width:4px}.post-body{font-family:EB Garamond,'Noto Serif SC','PingFang SC','Microsoft YaHei',sans-serif;overflow-wrap:break-word}@media (min-width:1200px){.post-body{font-size:1.125em}}@media (min-width:992px){.post-body{text-align:justify}}.post-body h1 .header-anchor,.post-body h1 .headerlink,.post-body h2 .header-anchor,.post-body h2 .headerlink,.post-body h3 .header-anchor,.post-body h3 .headerlink,.post-body h4 .header-anchor,.post-body h4 .headerlink,.post-body h5 .header-anchor,.post-body h5 .headerlink,.post-body h6 .header-anchor,.post-body h6 .headerlink{border-bottom-style:none;color:inherit;float:right;font-size:.875em;margin-left:10px;opacity:0}.post-body h1 .header-anchor::before,.post-body h1 .headerlink::before,.post-body h2 .header-anchor::before,.post-body h2 .headerlink::before,.post-body h3 .header-anchor::before,.post-body h3 .headerlink::before,.post-body h4 .header-anchor::before,.post-body h4 .headerlink::before,.post-body h5 .header-anchor::before,.post-body h5 .headerlink::before,.post-body h6 .header-anchor::before,.post-body h6 .headerlink::before{content:'\f0c1';font-family:'Font Awesome 6 Free';font-weight:900}.post-body h1:hover .header-anchor,.post-body h1:hover .headerlink,.post-body h2:hover .header-anchor,.post-body h2:hover .headerlink,.post-body h3:hover .header-anchor,.post-body h3:hover .headerlink,.post-body h4:hover .header-anchor,.post-body h4:hover .headerlink,.post-body h5:hover .header-anchor,.post-body h5:hover .headerlink,.post-body h6:hover .header-anchor,.post-body h6:hover .headerlink{opacity:.5}.post-body h1:hover .header-anchor:hover,.post-body h1:hover .headerlink:hover,.post-body h2:hover .header-anchor:hover,.post-body h2:hover .headerlink:hover,.post-body h3:hover .header-anchor:hover,.post-body h3:hover .headerlink:hover,.post-body h4:hover .header-anchor:hover,.post-body h4:hover .headerlink:hover,.post-body h5:hover .header-anchor:hover,.post-body h5:hover .headerlink:hover,.post-body h6:hover .header-anchor:hover,.post-body h6:hover .headerlink:hover{opacity:1}.post-body .exturl .fa{font-size:.875em;margin-left:4px}.post-body .fancybox+figcaption,.post-body .image-caption,.post-body img+figcaption{color:#999;font-size:.875em;font-weight:700;line-height:1;margin:-15px auto 15px;text-align:center}.post-body embed,.post-body iframe,.post-body img,.post-body video{margin-bottom:20px}.post-body .video-container{height:0;margin-bottom:20px;overflow:hidden;padding-top:75%;position:relative;width:100%}.post-body .video-container embed,.post-body .video-container iframe,.post-body .video-container object{height:100%;left:0;margin:0;position:absolute;top:0;width:100%}.post-gallery{display:flex;min-height:200px}.post-gallery .post-gallery-image{flex:1}.post-gallery .post-gallery-image:not(:first-child){clip-path:polygon(40px 0,100% 0,100% 100%,0 100%);margin-left:-20px}.post-gallery .post-gallery-image:not(:last-child){margin-right:-20px}.post-gallery .post-gallery-image img{height:100%;object-fit:cover;opacity:1;width:100%}.posts-expand .post-gallery{margin-bottom:60px}.posts-collapse .post-gallery{margin:15px 0}.posts-expand .post-header{font-size:1.125em;margin-bottom:60px;text-align:center}.posts-expand .post-title{font-size:1.5em;font-weight:400;margin:initial;overflow-wrap:break-word}.posts-expand .post-title-link{border-bottom:0;color:var(--link-color);display:inline-block;position:relative}.posts-expand .post-title-link::before{background:var(--link-color);bottom:0;content:'';height:2px;left:0;position:absolute;transform:scaleX(0);transition:transform .2s ease-in-out;width:100%}.posts-expand .post-title-link:hover::before{transform:scaleX(1)}.posts-expand .post-title-link .fa-external-link-alt{font-size:.875em;margin-left:5px}.post-sticky-flag{display:inline-block;margin-right:8px;transform:rotate(30deg)}.posts-expand .post-meta-container{color:#999;font-family:EB Garamond,'Noto Serif SC','PingFang SC','Microsoft YaHei',sans-serif;font-size:.75em;margin-top:3px}.posts-expand .post-meta-container .post-description{font-size:.875em;margin-top:2px}.posts-expand .post-meta-container time{border-bottom:1px dashed #999}.post-meta{display:flex;flex-wrap:wrap;justify-content:center}:not(.post-meta-break)+.post-meta-item::before{content:'|';margin:0 .5em}.post-meta-item-icon{margin-right:3px}@media (max-width:991px){.back-to-top{right:20px;opacity:.8}.post-body{text-align:justify}.post-meta-item-text{display:none}}.post-meta-break{flex-basis:100%;height:0}.post-nav{border-top:1px solid #eee;display:flex;gap:30px;justify-content:space-between;margin-top:1em;padding:10px 5px 0}.post-nav-item{flex:1}.post-nav-item a{border-bottom:0;display:block;font-size:.875em;line-height:1.6}.post-nav-item a:active{top:2px}.post-nav-item .fa{font-size:.75em}.post-nav-item:first-child .fa{margin-right:5px}.post-nav-item:last-child{text-align:right}.post-nav-item:last-child .fa{margin-left:5px}.post-footer{display:flex;flex-direction:column;justify-content:center}.post-eof{background:#ccc;height:1px;margin:80px auto 60px;width:8%}.post-block:last-of-type .post-eof{display:none}.post-tags{margin-top:40px;text-align:center}.post-tags a{display:inline-block;font-size:.8125em}.post-tags a:not(:last-child){margin-right:10px}.social-like{border-top:1px solid #eee;font-size:.875em;margin-top:1em;padding-top:1em;text-align:center}.reward-container{margin:1em 0 0;padding:1em 0;text-align:center}.reward-container button{background:0 0;color:#fc6423;cursor:pointer;line-height:2;padding:0 15px;border:2px solid #fc6423;border-radius:2px;outline:0;transition:.2s ease-in-out;vertical-align:text-top}.reward-container button:hover{background:#fc6423;color:#fff}.post-reward{display:none;padding-top:20px}.post-reward.active{display:block}.post-reward div{display:inline-block}.post-reward div span{display:block}.post-reward img{display:inline-block;margin:.8em 2em 0;max-width:100%;width:180px}@keyframes next-roll{from{transform:rotateZ(30deg)}to{transform:rotateZ(-30deg)}}.category-all-page .category-all-title{text-align:center}.category-all-page .category-all{margin-top:20px}.category-all-page .category-list{list-style:none;margin:0;padding:0}.category-all-page .category-list-item{margin:5px 10px}.category-all-page .category-list-count{color:#bbb}.category-all-page .category-list-count::before{content:' ('}.category-all-page .category-list-count::after{content:') '}.category-all-page .category-list-child{padding-left:10px}.event-list hr{background:#222;margin:20px 0 45px}.event-list hr::after{background:#222;color:#fff;content:'NOW';display:inline-block;font-weight:700;padding:0 5px}.event-list .event{--event-background:#222;--event-foreground:#bbb;--event-title:#fff;background:var(--event-background);padding:15px}.event-list .event .event-summary{border-bottom:0;color:var(--event-title);margin:0;padding:0 0 0 35px;position:relative}.event-list .event .event-summary::before{animation:1s ease-in-out infinite alternate dot-flash;background:var(--event-title);left:0;margin-top:-6px;position:absolute;top:50%;border-radius:50%;content:' ';height:12px;width:12px}.event-list .event:nth-of-type(odd) .event-summary::before{animation-delay:.5s}.event-list .event:not(:last-child){margin-bottom:20px}.event-list .event .event-relative-time{color:var(--event-foreground);display:inline-block;font-size:12px;font-weight:400;padding-left:12px}.event-list .event .event-details{color:var(--event-foreground);display:block;line-height:18px;padding:6px 0 6px 35px}.event-list .event .event-details::before{color:var(--event-foreground);display:inline-block;margin-right:9px;width:14px;font-family:'Font Awesome 6 Free';font-weight:900}.event-list .event .event-details.event-location::before{content:'\f041'}.event-list .event .event-details.event-duration::before{content:'\f017'}.event-list .event .event-details.event-description::before{content:'\f024'}.event-list .event-past{--event-background:#f5f5f5;--event-foreground:#999;--event-title:#222}@keyframes dot-flash{from{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}ul.breadcrumb{font-size:.75em;list-style:none;margin:1em 0;padding:0 2em;text-align:center}ul.breadcrumb li{display:inline}ul.breadcrumb li:not(:first-child)::before{content:'/\00a0';font-weight:400;padding:.5em}ul.breadcrumb li:last-child{font-weight:700}.tag-cloud{text-align:center}.tag-cloud a{display:inline-block;margin:10px}.tag-cloud-0{border-bottom-color:#aaa;color:#aaa}.tag-cloud-1{border-bottom-color:#9a9a9a;color:#9a9a9a}.tag-cloud-2{border-bottom-color:#8b8b8b;color:#8b8b8b}.tag-cloud-3{border-bottom-color:#7c7c7c;color:#7c7c7c}.tag-cloud-4{border-bottom-color:#6c6c6c;color:#6c6c6c}.tag-cloud-5{border-bottom-color:#5d5d5d;color:#5d5d5d}.tag-cloud-6{border-bottom-color:#4e4e4e;color:#4e4e4e}.tag-cloud-7{border-bottom-color:#3e3e3e;color:#3e3e3e}.tag-cloud-8{border-bottom-color:#2f2f2f;color:#2f2f2f}.tag-cloud-9{border-bottom-color:#202020;color:#202020}.tag-cloud-10{border-bottom-color:#111;color:#111}.search-active{overflow:hidden}.search-pop-overlay{background:rgba(0,0,0,0);display:flex;height:100%;left:0;position:fixed;top:0;transition:visibility .4s,background .4s;visibility:hidden;width:100%;z-index:40}.search-active .search-pop-overlay{background:rgba(0,0,0,.3);visibility:visible}.search-popup{background:var(--card-bg-color);border-radius:5px;height:80%;margin:auto;transform:scale(0);transition:transform .4s;width:700px}.search-active .search-popup{transform:scale(1)}@media (max-width:767px){.search-popup{border-radius:0;height:100%;width:100%}}.search-popup .popup-btn-close,.search-popup .search-icon{color:#999;font-size:18px;padding:0 10px}.search-popup .popup-btn-close{cursor:pointer}.search-popup .popup-btn-close:hover .fa{color:#222}.search-popup .search-header{background:#eee;border-top-left-radius:5px;border-top-right-radius:5px;display:flex;padding:5px}.search-popup input.search-input{background:0 0;border:0;outline:0;width:100%}.search-popup input.search-input::-webkit-search-cancel-button{display:none}.search-popup .search-result-container{height:calc(100% - 55px);overflow:auto;padding:5px 25px}.search-popup .search-result-container hr{margin:5px 0 10px}.search-popup .search-result-container hr:first-child{display:none}.search-popup .search-result-list{margin:0 5px;padding:0;width:100%}.search-popup a.search-result-title{font-weight:700}.search-popup p.search-result{border-bottom:1px dashed #ccc;padding:5px 0}.search-popup .search-input-container{flex-grow:1;padding:2px}.search-popup .no-result{display:flex}.search-popup .search-result-icon{color:#ccc;margin:auto}mark.search-keyword{background:0 0;border-bottom:1px dashed #ff2a2a;color:#ff2a2a;font-weight:700}.use-motion .animated{animation-fill-mode:none;visibility:inherit}.use-motion .sidebar .animated{animation-fill-mode:both}.header{background:var(--content-bg-color);border-radius:initial;box-shadow:initial}.main{align-items:stretch;display:flex;justify-content:space-between;margin:0 auto;width:calc(100% - 20px)}@media (max-width:767px){.main{width:auto}}@media (min-width:1200px){.main{width:1160px}}@media (min-width:1600px){.main{width:73%}}@media (max-width:991px){.header{border-radius:initial}.main{display:block;width:auto}}.main-inner{border-radius:initial;box-sizing:border-box;width:calc(100% - 252px)}.footer-inner{padding-left:252px}@media (max-width:991px){.main-inner{border-radius:initial;width:100%}.footer-inner{padding-left:0;padding-right:0;width:auto}}.column{width:240px}.site-brand-container{background:var(--theme-color)}.site-meta{padding:20px 0}.site-nav-right .toggle,.site-nav-toggle .toggle{color:#fff}.site-nav-right .toggle .toggle-line,.site-nav-toggle .toggle .toggle-line{background:#fff}@media (min-width:768px) and (max-width:991px){.site-nav-right,.site-nav-toggle{display:flex;flex-direction:column;justify-content:center}.site-nav{--scroll-height:0;height:0;overflow:hidden;transition:height .2s ease-in-out}body:not(.site-nav-on) .site-nav .animated{animation:none}body.site-nav-on .site-nav{height:var(--scroll-height)}}.menu .menu-item{display:block;margin:0}.menu .menu-item a{padding:5px 20px;position:relative;text-align:left;transition-property:background-color}.menu .menu-item .badge{background:#ccc;border-radius:10px;color:var(--content-bg-color);float:right;padding:2px 5px;text-shadow:1px 1px 0 rgba(0,0,0,.1)}.main-menu .menu-item-active::after{background:#bbb;border-radius:50%;content:' ';height:6px;margin-top:-3px;position:absolute;right:15px;top:50%;width:6px}.sub-menu{margin:0;padding:6px 0}.sub-menu .menu-item{display:inline-block}.sub-menu .menu-item a{background:0 0;margin:5px 10px;padding:initial}.sub-menu .menu-item a:hover{background:0 0;color:#fc6423}.sub-menu .menu-item-active{border-bottom-color:#fc6423;color:#fc6423}.sub-menu .menu-item-active:hover{border-bottom-color:#fc6423}.sidebar{position:-webkit-sticky;position:sticky;top:12px}@media (max-width:991px){.column{width:auto}.site-nav-on .site-brand-container{box-shadow:0 0 16px rgba(0,0,0,.5)}.menu .menu-item.menu-item-search,.sidebar{display:none}}.sidebar-inner{background:var(--content-bg-color);border-radius:initial;box-shadow:initial;box-sizing:border-box;color:var(--text-color);margin-top:12px;max-height:calc(100vh - 24px);visibility:hidden}.site-state-item{padding:0 10px}.sidebar .sidebar-button{border-bottom:1px dotted #ccc;border-top:1px dotted #ccc}.sidebar .sidebar-button button{border:0;color:#fc6423;display:block;width:100%}.sidebar .sidebar-button button:hover{background:0 0;border:0;color:#e34603}.links-of-author{display:flex;flex-wrap:wrap;justify-content:center}.links-of-author-item{margin:5px 0 0;width:50%}.links-of-author-item a{box-sizing:border-box;max-width:100%;overflow:hidden;padding:0 5px;text-overflow:ellipsis;white-space:nowrap;border-bottom:0;border-radius:4px;display:block}.links-of-author-item a:hover{background:var(--body-bg-color)}.main-inner{background:var(--content-bg-color);box-shadow:initial;padding:40px}@media (max-width:991px){.main-inner{padding:20px}}.sub-menu{border-bottom:1px solid #ddd}.post-block:first-of-type{padding-top:40px}@media (max-width:767px){.pagination{margin-bottom:10px}}</style><link crossorigin=anonymous href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css integrity=sha256-Z1K5uhUaJXA7Ll0XrZ/0JhX4lAtZFpT6jkKrEDT0drU= rel=stylesheet><link crossorigin=anonymous href=https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css integrity=sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE= rel=stylesheet><script class=next-config data-name=main type=application/json>{"hostname":"gzwilly.blog","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.14.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src=/js/config.js></script><meta content="摘自《企业级 Go 项目开发实战》图书 如何写出优雅的Go项目？那么，如何写出一个优雅的**Go项目**呢？在回答这个问题之前，我们先来看另外两个问题： 1.  为什么是Go项目，而不是Go应用？2.  一个优雅的Go项目具有哪些特点？ 先来看第一个问题。Go项目是一个偏工程化的概念，不仅包含了Go应用，还包含了项目管理和项目文档：  这就来到了第二个问题，一个优雅的Go项目，不仅要求我们的Go应" name=description><meta content=article property=og:type><meta content="05 | 设计方法：怎么写出优雅的 Go 项目" property=og:title><meta content=http://gzwilly.blog/post/2023-golang-practice-%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98-05-how-to-go.html property=og:url><meta content=gzwilly'blog property=og:site_name><meta content="摘自《企业级 Go 项目开发实战》图书 如何写出优雅的Go项目？那么，如何写出一个优雅的**Go项目**呢？在回答这个问题之前，我们先来看另外两个问题： 1.  为什么是Go项目，而不是Go应用？2.  一个优雅的Go项目具有哪些特点？ 先来看第一个问题。Go项目是一个偏工程化的概念，不仅包含了Go应用，还包含了项目管理和项目文档：  这就来到了第二个问题，一个优雅的Go项目，不仅要求我们的Go应" property=og:description><meta content=zh_CN property=og:locale><meta content=https://static001.geekbang.org/resource/image/24/aa/24ba3548f8574a747b51e291224097aa.png property=og:image><meta content=https://static001.geekbang.org/resource/image/77/03/77d541223576135df4c3d511abbfe603.png property=og:image><meta content=https://static001.geekbang.org/resource/image/23/69/2392d94feb95d3d64d765abe7d6e5e69.png property=og:image><meta content=https://static001.geekbang.org/resource/image/ed/46/ed0c3dfyy52ac82539cb602eec9f0146.png property=og:image><meta content=https://static001.geekbang.org/resource/image/0d/a5/0d65eb1363bf8055e209bc24d1d99ca5.png property=og:image><meta content=https://static001.geekbang.org/resource/image/0c/97/0cef423ec1a4f06f6f4715bd0b9f4497.png property=og:image><meta content=https://static001.geekbang.org/resource/image/d2/89/d2fae0aca602c7c33466411e39c49489.png property=og:image><meta content=https://static001.geekbang.org/resource/image/27/b8/27c84757b1f4626e84535d994ca70eb8.png property=og:image><meta content=https://static001.geekbang.org/resource/image/14/9c/1440f4bbcda682c8f5e7a599c8c51f9c.png property=og:image><meta content=https://static001.geekbang.org/resource/image/19/3b/19b697bbbe31450d6cc8f222491d3e3b.png property=og:image><meta content=https://static001.geekbang.org/resource/image/61/6d/61e022c1b25dab2b0fefb407fc1c776d.png property=og:image><meta content=https://static001.geekbang.org/resource/image/90/80/90ca527c2863fe642f9ab3d5b90fe980.png property=og:image><meta content=https://static001.geekbang.org/resource/image/b0/cc/b051da025c897996473df44693ea4ecc.png property=og:image><meta content=2023-03-27T06:40:50.000Z property=article:published_time><meta content=2023-03-27T06:40:50.000Z property=article:modified_time><meta content=gzwillyy property=article:author><meta content=Golang property=article:tag><meta content=IAM property=article:tag><meta content=设计方法 property=article:tag><meta content=summary name=twitter:card><meta content=https://static001.geekbang.org/resource/image/24/aa/24ba3548f8574a747b51e291224097aa.png name=twitter:image><link href=http://gzwilly.blog/post/2023-golang-practice-%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98-05-how-to-go.html rel=canonical><script class=next-config data-name=page type=application/json>{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://gzwilly.blog/post/2023-golang-practice-%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98-05-how-to-go.html","path":"/post/2023-golang-practice-开发实战-05-how-to-go.html","title":"05 | 设计方法：怎么写出优雅的 Go 项目"}</script><script class=next-config data-name=calendar type=application/json>""</script><title>05 | 设计方法：怎么写出优雅的 Go 项目 | gzwilly'blog</title><noscript><link href=/css/noscript.css rel=stylesheet></noscript><body class=use-motion itemscope itemtype=http://schema.org/WebPage><div class=headband></div><main class=main><div class=column><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=site-brand-container><div class=site-nav-toggle><div aria-label=切换导航栏 class=toggle role=button><span class=toggle-line></span><span class=toggle-line></span><span class=toggle-line></span></div></div><div class=site-meta><a class=brand href=/ rel=start> <i class=logo-line></i> <p class=site-title>gzwilly'blog</p> <i class=logo-line></i> </a></div><div class=site-nav-right><div class="toggle popup-trigger" aria-label=搜索 role=button><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ rel=section><i class="fa fa-home fa-fw"></i>首页</a><li class="menu-item menu-item-tags"><a href=/tags/ rel=section><i class="fa fa-tags fa-fw"></i>标签</a><li class="menu-item menu-item-categories"><a href=/categories/ rel=section><i class="fa fa-th fa-fw"></i>分类</a><li class="menu-item menu-item-archives"><a href=/archives/ rel=section><i class="fa fa-archive fa-fw"></i>归档</a><li class="menu-item menu-item-sitemap"><a href=/sitemap.xml rel=section><i class="fa fa-sitemap fa-fw"></i>站点地图</a><li class="menu-item menu-item-search"><a class=popup-trigger role=button><i class="fa fa-search fa-fw"></i>搜索 </a></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon> <i class="fa fa-search"></i> </span><div class=search-input-container><input autocapitalize=off autocomplete=off class=search-input maxlength=80 placeholder=搜索... spellcheck=false type=search></div><span class=popup-btn-close role=button> <i class="fa fa-times-circle"></i> </span></div><div class="search-result-container no-result"><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录<li class=sidebar-nav-overview>站点概览</ul><div class=sidebar-panel-container><!--noindex--><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class=nav><li class="nav-item nav-level-2"><a class=nav-link href=#%E5%A6%82%E4%BD%95%E5%86%99%E5%87%BA%E4%BC%98%E9%9B%85%E7%9A%84Go%E9%A1%B9%E7%9B%AE%EF%BC%9F><span class=nav-number>1.</span> <span class=nav-text>如何写出优雅的Go项目？</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#%E7%BC%96%E5%86%99%E9%AB%98%E8%B4%A8%E9%87%8F%E7%9A%84Go%E5%BA%94%E7%94%A8><span class=nav-number>2.</span> <span class=nav-text>编写高质量的Go应用</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#%E4%BB%A3%E7%A0%81%E7%BB%93%E6%9E%84><span class=nav-number>2.1.</span> <span class=nav-text>代码结构</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83><span class=nav-number>2.2.</span> <span class=nav-text>代码规范</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E4%BB%A3%E7%A0%81%E8%B4%A8%E9%87%8F><span class=nav-number>2.3.</span> <span class=nav-text>代码质量</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E7%BC%96%E7%A8%8B%E5%93%B2%E5%AD%A6><span class=nav-number>2.4.</span> <span class=nav-text>编程哲学</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E8%BD%AF%E4%BB%B6%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%B3%95><span class=nav-number>2.5.</span> <span class=nav-text>软件设计方法</span></a></ol><li class="nav-item nav-level-2"><a class=nav-link href=#%E9%AB%98%E6%95%88%E7%AE%A1%E7%90%86%E9%A1%B9%E7%9B%AE><span class=nav-number>3.</span> <span class=nav-text>高效管理项目</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#%E9%AB%98%E6%95%88%E7%9A%84%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B><span class=nav-number>3.1.</span> <span class=nav-text>高效的开发流程</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E4%BD%BF%E7%94%A8Makefile%E7%AE%A1%E7%90%86%E9%A1%B9%E7%9B%AE><span class=nav-number>3.2.</span> <span class=nav-text>使用Makefile管理项目</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E4%BB%A3%E7%A0%81><span class=nav-number>3.3.</span> <span class=nav-text>自动生成代码</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E5%96%84%E4%BA%8E%E5%80%9F%E5%8A%A9%E5%B7%A5%E5%85%B7><span class=nav-number>3.4.</span> <span class=nav-text>善于借助工具</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E5%AF%B9%E6%8E%A5CI-x2F-CD><span class=nav-number>3.5.</span> <span class=nav-text>对接CI/CD</span></a></ol><li class="nav-item nav-level-2"><a class=nav-link href=#%E7%BC%96%E5%86%99%E9%AB%98%E8%B4%A8%E9%87%8F%E7%9A%84%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3><span class=nav-number>4.</span> <span class=nav-text>编写高质量的项目文档</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#%E6%80%BB%E7%BB%93><span class=nav-number>5.</span> <span class=nav-text>总结</span></a></ol></div></div><!--/noindex--><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop=author itemscope itemtype=http://schema.org/Person><p class=site-author-name itemprop=name>gzwillyy<div class=site-description itemprop=description></div></div><div class="site-state-wrap animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/> <span class=site-state-item-count>69</span> <span class=site-state-item-name>日志</span> </a></div><div class="site-state-item site-state-categories"><a href=/categories/> <span class=site-state-item-count>14</span> <span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/> <span class=site-state-item-count>92</span> <span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-author animated"><span class=links-of-author-item> <a rel="noopener me" title="GitHub → https://github.com/gzwillyy" href=https://github.com/gzwillyy target=_blank><i class="fab fa-github fa-fw"></i>GitHub</a> </span></div></div></div></div></aside></div><div class="main-inner post posts-expand"><div class=post-block><article class=post-content itemscope itemtype=http://schema.org/Article lang=zh-CN><link href=http://gzwilly.blog/post/2023-golang-practice-%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98-05-how-to-go.html itemprop=mainEntityOfPage><span hidden itemprop=author itemscope itemtype=http://schema.org/Person> <meta content=/images/avatar.gif itemprop=image> <meta content=gzwillyy itemprop=name> </span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization> <meta content=gzwilly'blog itemprop=name> <meta itemprop=description> </span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork> <meta content="05 | 设计方法：怎么写出优雅的 Go 项目 | gzwilly'blog" itemprop=name> <meta itemprop=description> </span><header class=post-header><h1 itemprop="name headline" class=post-title>05 | 设计方法：怎么写出优雅的 Go 项目</h1><div class=post-meta-container><div class=post-meta><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar"></i> </span> <span class=post-meta-item-text>发表于</span> <time itemprop="dateCreated datePublished" title="创建时间：2023-03-27 14:40:50" datetime=2023-03-27T14:40:50+08:00>2023-03-27</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-folder"></i> </span> <span class=post-meta-item-text>分类于</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing> <a href=/categories/Golang-%E5%AE%9E%E6%88%98/ itemprop=url rel=index><span itemprop=name>Golang 实战</span></a> </span> </span></div></div></header><div class=post-body itemprop=articleBody><p><strong>摘自《企业级 Go 项目开发实战》图书</strong><h2 id=如何写出优雅的Go项目？><a class=headerlink href=#如何写出优雅的Go项目？ title=如何写出优雅的Go项目？></a>如何写出优雅的Go项目？</h2><p>那么，如何写出一个<strong>优雅</strong>的**<code>Go</code>项目**呢？在回答这个问题之前，我们先来看另外两个问题：<p><em><strong>1. 为什么是<code>Go</code>项目，而不是<code>Go</code>应用？</strong></em><br><em><strong>2. 一个优雅的<code>Go</code>项目具有哪些特点？</strong></em><p>先来看第一个问题。<code>Go</code>项目是一个偏工程化的概念，不仅包含了<code>Go</code>应用，还包含了项目管理和项目文档：<p><a href=https://static001.geekbang.org/resource/image/24/aa/24ba3548f8574a747b51e291224097aa.png rel=noopener target=_blank><img src=https://static001.geekbang.org/resource/image/24/aa/24ba3548f8574a747b51e291224097aa.png></a><p>这就来到了第二个问题，一个优雅的<code>Go</code>项目，不仅要求我们的<code>Go</code>应用是优雅的，还要确保我们的项目管理和文档也是优雅的。这样，我们根据前面几讲学到的<code>Go</code>设计规范，很容易就能总结出一个优雅的<code>Go</code>应用需要具备的特点：</p><span id=more></span><ul><li>符合<code>Go</code>编码规范和最佳实践；<li>易阅读、易理解，易维护；<li>易测试、易扩展；<li>代码质量高。</ul><p>解决了这两个问题，让我们回到这一讲的核心问题：如何写出优雅的<code>Go</code>项目？<p>写出一个优雅的<code>Go</code>项目，在我看来，就是<strong>用“最佳实践”的方式去实现<code>Go</code>项目中的<code>Go</code>应用、项目管理和项目文档</strong>。具体来说，就是编写高质量的<code>Go</code>应用、高效管理项目、编写高质量的项目文档。<p>为了协助你理解，我将这些逻辑绘制成了下面一张图。<p><a href=https://static001.geekbang.org/resource/image/77/03/77d541223576135df4c3d511abbfe603.png rel=noopener target=_blank><img src=https://static001.geekbang.org/resource/image/77/03/77d541223576135df4c3d511abbfe603.png></a><p>接下来，我们就看看如何根据前面几讲学习的<code>Go</code>项目设计规范，实现一个优雅的<code>Go</code>项目。我们先从编写高质量的<code>Go</code>应用看起。<h2 id=编写高质量的Go应用><a class=headerlink href=#编写高质量的Go应用 title=编写高质量的Go应用></a>编写高质量的Go应用</h2><p>基于我的研发经验，要编写一个高质量的<code>Go</code>应用，其实可以归纳为5个方面：<code>代码结构</code>、<code>代码规范</code>、<code>代码质量</code>、<code>编程哲学</code>和<code>软件设计</code>方法，见下图。<p><a href=https://static001.geekbang.org/resource/image/23/69/2392d94feb95d3d64d765abe7d6e5e69.png rel=noopener target=_blank><img src=https://static001.geekbang.org/resource/image/23/69/2392d94feb95d3d64d765abe7d6e5e69.png></a><p>接下来，我们详细说说这些内容。<h3 id=代码结构><a class=headerlink href=#代码结构 title=代码结构></a>代码结构</h3><p>为什么先说代码结构呢？因为组织合理的代码结构是一个项目的门面。我们可以通过两个手段来组织代码结构。<p>第一个手段是，组织一个好的目录结构。关于如何组合一个好的目录结构，你可以回顾 <a href=https://time.geekbang.org/column/article/381392 rel=noopener target=_blank>06讲</a> 的内容。<p>第二个手段是，选择一个好的模块拆分方法。做好模块拆分，可以使项目内模块职责分明，做到低耦合高内聚。<p>那么<code>Go</code>项目开发中，如何拆分模块呢？目前业界有两种拆分方法，分别是按层拆分和按功能拆分。<p><strong>首先，我们看下按层拆分</strong>，最典型的是<code>MVC</code>架构中的模块拆分方式。在<code>MVC</code>架构中，我们将服务中的不同组件按访问顺序，拆分成了<code>Model</code>、<code>View</code>和<code>Controller</code>三层。<p><a href=https://static001.geekbang.org/resource/image/ed/46/ed0c3dfyy52ac82539cb602eec9f0146.png rel=noopener target=_blank><img src=https://static001.geekbang.org/resource/image/ed/46/ed0c3dfyy52ac82539cb602eec9f0146.png></a><p>每层完成不同的功能：<ul><li><code>View</code>（视图）是提供给用户的操作界面，用来处理数据的显示。<li><code>Controller</code>（控制器），负责根据用户从 <code>View</code> 层输入的指令，选取 <code>Model</code> 层中的数据，然后对其进行相应的操作，产生最终结果。<li><code>Model</code>（模型），是应用程序中用于处理数据逻辑的部分。</ul><p>我们看一个典型的按层拆分的目录结构：<pre class="line-numbers language-bash" data-language=bash><code class=language-bash>tree <span class="token parameter variable">--noreport</span> <span class="token parameter variable">-L</span> <span class="token number">2</span> layers
layers
├── controllers│
    ├── billing│
    ├── order│
    └── user
├── models│
    ├── billing.go
│   ├── order.go
│   └── user.go
└── views
└── layouts<span aria-hidden=true class=line-numbers-rows><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在<code>Go</code>项目中，按层拆分会带来很多问题。最大的问题是循环引用：相同功能可能在不同层被使用到，而这些功能又分散在不同的层中，很容易造成循环引用。<p>所以，<strong>你只要大概知道按层拆分是什么意思就够了，在<code>Go</code>项目中我建议你使用的是按功能拆分的方法，这也是<code>Go</code>项目中最常见的拆分方法。</strong><p>那什么是按功能拆分呢？我给你看一个例子你就明白了。比如，一个订单系统，我们可以根据不同功能将其拆分成<code>用户（user</code>）、<code>订单（order）</code>和<code>计费（billing）</code>3个模块，每一个模块提供独立的功能，功能更单一：<p><a href=https://static001.geekbang.org/resource/image/0d/a5/0d65eb1363bf8055e209bc24d1d99ca5.png rel=noopener target=_blank><img src=https://static001.geekbang.org/resource/image/0d/a5/0d65eb1363bf8055e209bc24d1d99ca5.png></a><p>下面是该订单系统的代码目录结构：<pre class="line-numbers language-bash" data-language=bash><code class=language-bash>tree pkg
tree <span class="token parameter variable">--noreport</span> <span class="token parameter variable">-L</span> <span class="token number">2</span> pkg
pkg
├── billing
├── order
│   └── order.go
└── user<span aria-hidden=true class=line-numbers-rows><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>相较于按层拆分，按功能拆分模块带来的好处也很好理解：<ul><li>不同模块，功能单一，可以实现高内聚低耦合的设计哲学。<li>因为所有的功能只需要实现一次，引用逻辑清晰，会大大减少出现循环引用的概率。</ul><p>所以，有很多优秀的<code>Go</code>项目采用的都是按功能拆分的模块拆分方式，例如 <code>Kubernetes</code>、<code>Docker</code>、<code>Helm</code>、<code>Prometheus</code>等。<p>除了组织合理的代码结构这种方式外，编写高质量<code>Go</code>应用的另外一个行之有效的方法，是遵循<code>Go</code>语言代码规范来编写代码。在我看来，这也是最容易出效果的方式。<h3 id=代码规范><a class=headerlink href=#代码规范 title=代码规范></a>代码规范</h3><p>那我们要遵循哪些代码规范来编写<code>Go</code>应用呢？在我看来，其实就两类：编码规范和最佳实践。<p><strong>首先，我们的代码要符合<code>Go</code>编码规范，这是最容易实现的途径</strong>。<code>Go</code>社区有很多这类规范可供参考，其中，比较受欢迎的是<a href=https://github.com/xxjwxc/uber_go_guide_cn rel=noopener target=_blank>Uber <code>Go</code> 语言编码规范</a>。<p>阅读这些规范确实有用，也确实花时间、花精力。所以，我在参考了已有的很多规范后，结合自己写<code>Go</code>代码的经验，特地为你整理了一篇<code>Go</code>编码规范作为加餐，也就是“特别放送 | 给你一份清晰、可直接套用的<code>Go</code>编码规范”。<p>有了可以参考的编码规范之后，我们需要扩展到团队、部门甚至公司层面。只有大家一起参与、遵守，规范才会变得有意义。其实，我们都清楚，要开发者靠自觉来遵守所有的编码规范，不是一件容易的事儿。这时候，我们可以使用静态代码检查工具，来约束开发者的行为。<p>有了静态代码检查工具后，不仅可以确保开发者写出的每一行代码都是符合<code>Go</code>编码规范的，还可以将静态代码检查集成到<code>CI/CD</code>流程中。这样，在代码提交后自动地检查代码，就保证了只有符合编码规范的代码，才会被合入主干。<p><code>Go</code>语言的静态代码检查工具有很多，目前用的最多的是<a href=https://github.com/golangci/golangci-lint rel=noopener target=_blank>golangci-lint</a>，这也是我极力推荐你使用的一个工具。<p>除了遵循编码规范，<strong>要想成为<code>Go</code>编程高手，你还得学习并遵循一些最佳实践</strong>。“最佳实践”是社区经过多年探索沉淀下来的、符合<code>Go</code>语言特色的经验和共识，它可以帮助你开发出一个高质量的代码。<p>这里我给你推荐几篇介绍<code>Go</code>语言最佳实践的文章，供你参考：<ul><li><a href=https://golang.org/doc/effective_go rel=noopener target=_blank>Effective Go</a>：高效<code>Go</code>编程，由<code>Golang</code>官方编写，里面包含了编写<code>Go</code>代码的一些建议，也可以理解为最佳实践。<li><a href=https://github.com/golang/go/wiki/CodeReviewComments rel=noopener target=_blank>Go Code Review Comments</a>：<code>Golang</code>官方编写的<code>Go</code>最佳实践，作为<code>Effective Go</code>的补充。<li><a href=https://rakyll.org/style-packages/ rel=noopener target=_blank>Style guideline for Go packages</a>：包含了如何组织<code>Go</code>包、如何命名<code>Go</code>包、如何写<code>Go</code>包文档的一些建议。</ul><h3 id=代码质量><a class=headerlink href=#代码质量 title=代码质量></a>代码质量</h3><p>有了组织合理的代码结构、符合<code>Go</code>语言代码规范的<code>Go</code>应用代码之后，我们还需要通过一些手段来确保我们开发出的是一个高质量的代码，这可以通过<code>单元测试</code>和<code>Code Review</code>来实现。<p><strong>单元测试非常重要。</strong>我们开发完一段代码后，第一个执行的测试就是单元测试。它可以保证我们的代码是符合预期的，一些异常变动能够被及时感知到。进行单元测试，不仅需要编写单元测试用例，还需要我们确保代码是可测试的，以及具有一个高的单元测试覆盖率。<p>接下来，我就来介绍下如何编写一个可测试的代码。<p>如果我们要对函数A进行测试，并且A中的所有代码均能够在<code>单元测试环境</code>下按预期被执行，那么<code>函数A</code>的代码块就是可测试的。我们来看下一般的<code>单元测试环境</code>有什么特点：<ul><li>可能无法连接数据库。<li>可能无法访问第三方服务。</ul><p>如果<code>函数A</code>依赖<code>数据库连接</code>、<code>第三方服务</code>，那么在<code>单元测试环境</code>下执行单元测试就会失败，函数就没法测试，函数是不可测的。<p>解决方法也很简单：将<code>依赖的数据库</code>、<code>第三方服务</code>等抽象成<code>接口</code>，在被测代码中调用<code>接口</code>的方法，在测试时传入<code>mock</code>类型，从而将<code>数据库</code>、<code>第三方服务</code>等依赖从具体的被测函数中解耦出去。如下图所示：<p><a href=https://static001.geekbang.org/resource/image/0c/97/0cef423ec1a4f06f6f4715bd0b9f4497.png rel=noopener target=_blank><img src=https://static001.geekbang.org/resource/image/0c/97/0cef423ec1a4f06f6f4715bd0b9f4497.png></a><p>为了提高代码的可测性，降低单元测试的复杂度，对 <code>function</code> 和 <code>mock</code> 的要求是：<ul><li>要尽可能减少 <code>function</code> 中的依赖，让 <code>function</code> 只依赖必要的模块。编写一个功能单一、职责分明的函数，会有利于减少依赖。<li>依赖模块应该是易 <code>Mock</code> 的。</ul><p>为了协助你理解，我们先来看一段不可测试的代码：<pre class="line-numbers language-go" data-language=go><code class=language-go><span class="token keyword">package</span> post

<span class="token keyword">import</span> <span class="token string">"google.golang.org/grpc"</span>

<span class="token keyword">type</span> Post <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  Name <span class="token builtin">string</span> <span class="token string">`json:"name"`</span>
  Address <span class="token builtin">string</span> <span class="token string">`json:"address"`</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">ListPosts</span><span class="token punctuation">(</span>client <span class="token operator">*</span>grpc<span class="token punctuation">.</span>ClientConn<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>Post<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">return</span> client<span class="token punctuation">.</span><span class="token function">ListPosts</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span aria-hidden=true class=line-numbers-rows><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这段代码中的 <code>ListPosts 函数</code> 是不可测试的。因为 <code>ListPosts 函数</code> 中调用了<code>client.ListPosts()</code>方法，该方法依赖于一个 <code>gRPC</code> 连接。而我们在做<code>单元测试</code>时，可能因为没有配置 <code>gRPC 服务的地址</code>、<code>网络隔离</code> 等原因，导致没法建立 <code>gRPC 连接</code>，从而导致 <code>ListPosts 函数</code> 执行失败。<p>下面，我们把这段代码改成可测试的，如下：<pre class="line-numbers language-go" data-language=go><code class=language-go><span class="token keyword">package</span> main

<span class="token keyword">type</span> Post <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  Name <span class="token builtin">string</span> <span class="token string">`json:"name"`</span>
  Address <span class="token builtin">string</span> <span class="token string">`json:"address"`</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> Service <span class="token keyword">interface</span> <span class="token punctuation">{</span>
  <span class="token function">ListPosts</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>Post<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">ListPosts</span><span class="token punctuation">(</span>svc Service<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>Post<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> svc<span class="token punctuation">.</span><span class="token function">ListPosts</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span aria-hidden=true class=line-numbers-rows><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>上面代码中，<code>ListPosts 函数</code> 入参为 <code>Service 接口</code> 类型，只要我们传入一个实现了 <code>Service 接口</code> 类型的实例， <code>ListPosts 函数</code> 即可成功运行。因此，我们可以在单元测试中可以实现一个不依赖任何<code>第三方服务的 fake </code>实例，并传给 <code>ListPosts</code> 。上述可测代码的单元测试代码如下：<pre class="line-numbers language-go" data-language=go><code class=language-go><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">"testing"</span>

<span class="token keyword">type</span> fakeService <span class="token keyword">struct</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">NewFakeService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> Service <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">&</span>fakeService<span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>fakeService<span class="token punctuation">)</span> <span class="token function">ListPosts</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>Post<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  posts <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>Post<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

  posts <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>posts<span class="token punctuation">,</span> <span class="token operator">&</span>Post<span class="token punctuation">{</span>
      Name<span class="token punctuation">:</span>    <span class="token string">"colin"</span><span class="token punctuation">,</span>
      Address<span class="token punctuation">:</span> <span class="token string">"Shenzhen"</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  posts <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>posts<span class="token punctuation">,</span> <span class="token operator">&</span>Post<span class="token punctuation">{</span>
    Name<span class="token punctuation">:</span>    <span class="token string">"alex"</span><span class="token punctuation">,</span>
    Address<span class="token punctuation">:</span> <span class="token string">"Beijing"</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> posts<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">TestListPosts</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  fake <span class="token operator">:=</span> <span class="token function">NewFakeService</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token keyword">if</span> <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">ListPosts</span><span class="token punctuation">(</span>fake<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    t<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span><span class="token string">"list posts failed"</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden=true class=line-numbers-rows><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>当我们的代码可测之后，就可以借助一些工具来 <code>Mock</code> 需要的接口了。常用的 <code>Mock</code> 工具，有这么几个：<ul><li><a href=https://github.com/golang/mock rel=noopener target=_blank>golang/mock</a>，是官方提供的 <code>Mock</code> 框架。它实现了基于interface的 <code>Mock</code> 功能，能够与<code>Golang</code>内置的testing包做很好的集成，是最常用的 <code>Mock</code> 工具。golang/mock提供了mockgen工具用来生成interface对应的 <code>Mock</code> 源文件。<li><a href=https://github.com/DATA-DOG/go-sqlmock rel=noopener target=_blank>sqlmock</a>，可以用来模拟数据库连接。数据库是项目中比较常见的依赖，在遇到数据库依赖时都可以用它。<li><a href=https://github.com/jarcoal/httpmock rel=noopener target=_blank>httpmock</a>，可以用来 <code>Mock</code> HTTP请求。<li><a href=https://github.com/bouk/monkey rel=noopener target=_blank>bouk/monkey</a>，猴子补丁，能够通过替换函数指针的方式来修改任意函数的实现。如果 <code>golang/mock</code>、<code>sqlmock</code> 和 <code>httpmock</code> 这几种方法都不能满足我们的需求，我们可以尝试通过猴子补丁的方式来 <code>Mock</code> 依赖。可以这么说，猴子补丁提供了单元测试 <code>Mock</code> 依赖的最终解决方案。</ul><p>接下来，我们再一起看看<strong>如何提高我们的单元测试覆盖率</strong>。<p>当我们编写了可测试的代码之后，接下来就需要编写足够的测试用例，用来提高项目的单元测试覆盖率。这里我有以下两个建议供你参考：<ul><li>使用 <code>gotests</code> 工具自动生成单元测试代码，减少编写单元测试用例的工作量，将你从重复的劳动中解放出来。<li>定期检查单元测试覆盖率。你可以通过以下方法来检查：</ul><pre class="line-numbers language-bash" data-language=bash><code class=language-bash>go <span class="token builtin class-name">test</span> <span class="token parameter variable">-race</span> <span class="token parameter variable">-cover</span>  <span class="token parameter variable">-coverprofile</span><span class="token operator">=</span>./coverage.out <span class="token parameter variable">-timeout</span><span class="token operator">=</span>10m <span class="token parameter variable">-short</span> <span class="token parameter variable">-v</span> ./<span class="token punctuation">..</span>.
go tool cover <span class="token parameter variable">-func</span> ./coverage.out<span aria-hidden=true class=line-numbers-rows><span></span><span></span></span></code></pre><p>执行结果如下：<p><a href=https://static001.geekbang.org/resource/image/d2/89/d2fae0aca602c7c33466411e39c49489.png rel=noopener target=_blank><img src=https://static001.geekbang.org/resource/image/d2/89/d2fae0aca602c7c33466411e39c49489.png></a><p>在提高项目的单元测试覆盖率时，我们可以先提高单元测试覆盖率低的函数，之后再检查项目的单元测试覆盖率；如果项目的单元测试覆盖率仍然低于期望的值，可以再次提高单元测试覆盖率低的函数的覆盖率，然后再检查。以此循环，最终将项目的单元测试覆盖率优化到预期的值为止。<p>这里要注意，对于一些可能经常会变动的函数单元测试，覆盖率要达到 <code>100%</code> 。<p>说完了单元测试，我们再看看<strong>如何通过 <code>Code Review</code> 来保证代码质量。</strong><p><code>Code Review</code> 可以提高代码质量、交叉排查缺陷，并且促进团队内知识共享，是保障代码质量非常有效的手段。在我们的项目开发中，一定要建立一套持久可行的 <code>Code Review</code> 机制。<p>但在我的研发生涯中，发现很多团队没有建立有效的 <code>Code Review</code> 机制。这些团队都认可 <code>Code Review</code> 机制带来的好处，但是因为流程难以遵守，慢慢地 <code>Code Review</code> 就变成了形式主义，最终不了了之。其实，建立 <code>Code Review</code> 机制很简单，主要有3点：<ul><li>首先，确保我们使用的代码托管平台有 <code>Code Review</code> 的功能。比如，GitHub、GitLab这类代码托管平台都具备这种能力。<li>接着，建立一套 <code>Code Review</code> 规范，规定如何进行 <code>Code Review</code> 。<li>最后，也是最重要的，每次代码变更，相关开发人员都要去落实 <code>Code Review</code> 机制，并形成习惯，直到最后形成团队文化。</ul><p><strong>到这里我们可以小结一下：组织一个合理的代码结构、编写符合<code>Go</code>代码规范的代码、保证代码质量，在我看来都是编写高质量<code>Go</code>代码的外功。那内功是什么呢？就是编程哲学和软件设计方法。</strong><h3 id=编程哲学><a class=headerlink href=#编程哲学 title=编程哲学></a>编程哲学</h3><p>那编程哲学是什么意思呢？在我看来，编程哲学，其实就是要编写符合<code>Go</code>语言设计哲学的代码。<code>Go</code>语言有很多设计哲学，对代码质量影响比较大的，我认为有两个：面向接口编程和面向“对象”编程。<p>我们先来看下面向接口编程。<p><code>Go</code> 接口是一组方法的集合。任何类型，只要实现了该接口中的方法集，那么就属于这个类型，也称为实现了该接口。<p>接口的作用，其实就是为不同层级的模块提供一个定义好的中间层。这样，上游不再需要依赖下游的具体实现，充分地对上下游进行了解耦。很多流行的<code>Go</code>设计模式，就是通过面向接口编程的思想来实现的。<p>我们看一个面向接口编程的例子。下面这段代码定义了一个<code>Bird</code>接口，<code>Canary</code> 和 <code>Crow</code> 类型均实现了<code>Bird</code>接口。<pre class="line-numbers language-go" data-language=go><code class=language-go><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">"fmt"</span>

<span class="token comment">// Bird 定义了一个鸟类</span>
<span class="token keyword">type</span> Bird <span class="token keyword">interface</span> <span class="token punctuation">{</span>
	<span class="token function">Fly</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token function">Type</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token comment">// Canary 鸟类：金丝雀</span>
<span class="token keyword">type</span> Canary <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	Name <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Canary<span class="token punctuation">)</span> <span class="token function">Fly</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"我是%s，用黄色的翅膀飞 \n"</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span>Name<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Canary<span class="token punctuation">)</span> <span class="token function">Type</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> c<span class="token punctuation">.</span>Name
<span class="token punctuation">}</span>

<span class="token comment">// Crow 鸟类：乌鸦</span>
<span class="token keyword">type</span> Crow <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	Name <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Crow<span class="token punctuation">)</span> <span class="token function">Fly</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"我是%s，我用黑色的翅膀飞 \n"</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span>Name<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Crow<span class="token punctuation">)</span> <span class="token function">Type</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> c<span class="token punctuation">.</span>Name
<span class="token punctuation">}</span>

<span class="token comment">// LetItFly 让鸟类飞一下</span>
<span class="token keyword">func</span> <span class="token function">LetItFly</span><span class="token punctuation">(</span>bird Bird<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Let %s Fly! \n"</span><span class="token punctuation">,</span> bird<span class="token punctuation">.</span><span class="token function">Type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	bird<span class="token punctuation">.</span><span class="token function">Fly</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">LetItFly</span><span class="token punctuation">(</span><span class="token operator">&</span>Canary<span class="token punctuation">{</span><span class="token string">"金丝雀"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token function">LetItFly</span><span class="token punctuation">(</span><span class="token operator">&</span>Crow<span class="token punctuation">{</span><span class="token string">"乌鸦"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span aria-hidden=true class=line-numbers-rows><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这段代码中，因为<code>Crow</code>和<code>Canary</code>都实现了<code>Bird</code>接口声明的<code>Fly</code>、<code>Type</code>方法，所以可以说<code>Crow</code>、<code>Canary</code>实现了<code>Bird</code>接口，属于<code>Bird</code>类型。在函数调用时，可以传入<code>Bird</code>类型，并在函数内部调用<code>Bird</code>接口提供的方法，以此来解耦<code>Bird</code>的具体实现。<p>好了，我们总结下使用接口的好处吧：<ul><li>代码扩展性更强了。例如，同样的<code>Bird</code>，可以有不同的实现。在开发中用的更多的是，将数据库的<code>CURD</code>操作抽象成接口，从而可以实现同一份代码对接不同数据库的目的。<li>可以解耦上下游的实现。例如，<code>LetItFly</code>不用关注<code>Bird</code>是如何<code>Fly</code>的，只需要调用<code>Bird</code>提供的方法即可。<li>提高了代码的可测性。因为接口可以解耦上下游实现，我们在单元测试需要依赖<code>第三方系统</code>/<code>数据库</code>的代码时，可以利用接口将具体实现解耦，实现<code>fake</code>类型。<li>代码更健壮、更稳定了。例如，如果要更改<code>Fly</code>的方式，只需要更改相关类型的<code>Fly</code>方法即可，完全影响不到<code>LetItFly</code>函数。</ul><p>所以，我建议你，在<code>Go</code>项目开发中，一定要多思考，那些可能有多种实现的地方，要考虑使用接口。<p>接下来，我们再来看下面向“对象”编程。<p>面向对象编程（<code>OOP</code>）有很多优点，例如可以使我们的代码变得易维护、易扩展，并能提高开发效率等，所以一个高质量的<code>Go</code>应用在需要时，也应该采用面向对象的方法去编程。那什么叫“在需要时”呢？就是我们在开发代码时，如果一个功能可以通过接近于日常生活和自然的思考方式来实现，这时候就应该考虑使用面向对象的编程方法。<p><code>Go</code>语言不支持面向对象编程，但是却可以通过一些语言级的特性来实现类似的效果。<p>面向对象编程中，有几个核心特性：<code>类</code>、<code>实例</code>、<code>抽象</code>，<code>封装</code>、<code>继承</code>、<code>多态</code>、<code>构造函数</code>、<code>析构函数</code>、<code>方法重载</code>、<code>this指针</code>。在<code>Go</code>中可以通过以下几个方式来实现类似的效果：<ul><li>类、抽象、封装通过结构体来实现。<li>实例通过结构体变量来实现。<li>继承通过组合来实现。这里解释下什么叫组合：一个结构体嵌到另一个结构体，称作组合。例如一个结构体包含了一个匿名结构体，就说这个结构体组合了该匿名结构体。<li>多态通过接口来实现。</ul><p>至于<code>构造函数</code>、<code>析构函数</code>、<code>方法重载</code>和<code>this指针</code>等，<code>Go</code>为了保持语言的简洁性去掉了这些特性。<p><code>Go</code>中面向对象编程方法，见下图：<p><a href=https://static001.geekbang.org/resource/image/27/b8/27c84757b1f4626e84535d994ca70eb8.png rel=noopener target=_blank><img src=https://static001.geekbang.org/resource/image/27/b8/27c84757b1f4626e84535d994ca70eb8.png></a><p>我们通过一个示例，来具体看下<code>Go</code>是如何实现面向对象编程中的<code>类</code>、<code>抽象</code>、<code>封装</code>、<code>继承</code>和<code>多态</code>的。代码如下：<pre class="line-numbers language-go" data-language=go><code class=language-go><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">"fmt"</span>

<span class="token comment">// Bird 基类：Bird</span>
<span class="token keyword">type</span> Bird <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	Type <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token comment">// Class 鸟的类别</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>bird <span class="token operator">*</span>Bird<span class="token punctuation">)</span> <span class="token function">Class</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> bird<span class="token punctuation">.</span>Type
<span class="token punctuation">}</span>

<span class="token comment">// Birds 定义了一个鸟类</span>
<span class="token keyword">type</span> Birds <span class="token keyword">interface</span> <span class="token punctuation">{</span>
	<span class="token function">Name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span>
	<span class="token function">Class</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token comment">// Canary 鸟类：金丝雀</span>
<span class="token keyword">type</span> Canary <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	Bird
	name <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Canary<span class="token punctuation">)</span> <span class="token function">Name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> c<span class="token punctuation">.</span>name
<span class="token punctuation">}</span>

<span class="token comment">// Crow 鸟类：乌鸦</span>
<span class="token keyword">type</span> Crow <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	Bird
	name <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Crow<span class="token punctuation">)</span> <span class="token function">Name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> c<span class="token punctuation">.</span>name
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">NewCrow</span><span class="token punctuation">(</span>name <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">*</span>Crow <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token operator">&</span>Crow<span class="token punctuation">{</span>
		Bird<span class="token punctuation">:</span> Bird<span class="token punctuation">{</span>Type<span class="token punctuation">:</span> <span class="token string">"Crow"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		name<span class="token punctuation">:</span> name<span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">NewCanary</span><span class="token punctuation">(</span>name <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">*</span>Canary <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token operator">&</span>Canary<span class="token punctuation">{</span>
		Bird<span class="token punctuation">:</span> Bird<span class="token punctuation">{</span>Type<span class="token punctuation">:</span> <span class="token string">"Canary"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		name<span class="token punctuation">:</span> name<span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">BirdInfo</span><span class="token punctuation">(</span>birds Birds<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"I'm %s, I belong to %s bird class! \n"</span><span class="token punctuation">,</span> birds<span class="token punctuation">.</span><span class="token function">Name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> birds<span class="token punctuation">.</span><span class="token function">Class</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	canary <span class="token operator">:=</span> <span class="token function">NewCanary</span><span class="token punctuation">(</span><span class="token string">"CanaryA"</span><span class="token punctuation">)</span>
	crow <span class="token operator">:=</span> <span class="token function">NewCrow</span><span class="token punctuation">(</span><span class="token string">"CrowA"</span><span class="token punctuation">)</span>
	<span class="token function">BirdInfo</span><span class="token punctuation">(</span>canary<span class="token punctuation">)</span>
	<span class="token function">BirdInfo</span><span class="token punctuation">(</span>crow<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span aria-hidden=true class=line-numbers-rows><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>将上述代码保存在<code>oop.go</code>文件中，执行以下代码输出如下：<pre class="line-numbers language-bash" data-language=bash><code class=language-bash>go run oop.go
I<span class="token string">'m CanaryA, I belong to Canary bird class!
I'</span>m CrowA, I belong to Crow bird class<span class="token operator">!</span><span aria-hidden=true class=line-numbers-rows><span></span><span></span><span></span></span></code></pre><p>在上面的例子中，分别通过<code>Canary</code>和<code>Crow</code>结构体定义了金丝雀和乌鸦两种类别的鸟，其中分别封装了<code>name</code>属性和<code>Name</code>方法。也就是说通过结构体实现了类，该类抽象了鸟类，并封装了该鸟类的属性和方法。<p>在<code>Canary</code>和<code>Crow</code>结构体中，都有一个<code>Bird</code>匿名字段，<code>Bird</code>字段为<code>Canary</code>和<code>Crow</code>类的父类， <code>Canary</code> 和Crow继承了Bird类的Class属性和方法。也就是说通过匿名字段实现了继承。<p>在<code>main</code>函数中，通过<code>NewCanary</code>创建了 <code>Canary</code> 鸟类实例，并将其传给<code>BirdInfo</code>函数。也就是说通过结构体变量实现实例。<p>在<code>BirdInfo</code>函数中，将<code>Birds</code>接口类型作为参数传入，并在函数中调用了<code>birds.Name</code>，<code>birds.Class</code>方法，这两个方法会根据<code>birds</code>类别的不同而返回不同的名字和类别，也就是说通过接口实现了多态。<h3 id=软件设计方法><a class=headerlink href=#软件设计方法 title=软件设计方法></a>软件设计方法</h3><p>接下来，我们继续学习编写高质量<code>Go</code>代码的第二项内功，也就是让编写的代码遵循一些业界沉淀下来的，优秀的软件设计方法。<p>优秀的软件设计方法有很多，其中有两类方法对我们代码质量的提升特别有帮助，分别是设计模式（<code>Design</code> <code>pattern</code>）和 <code>SOLID</code> 原则。<p>在我看来，设计模式可以理解为业界针对一些特定的场景总结出来的最佳实现方式。它的特点是解决的场景比较具体，实施起来会比较简单；而 <code>SOLID</code> 原则更侧重设计原则，需要我们彻底理解，并在编写代码时多思考和落地。<p>在软件领域，沉淀了一些比较优秀的设计模式，其中最受欢迎的是 <code>GOF</code> 设计模式。 <code>GOF</code> 设计模式中包含了3大类（<code>创建型模式</code>、<code>结构型模式</code>、<code>行为型模式</code>），共25种经典的、可以解决常见软件设计问题的设计方案。这25种设计方案同样也适用于<code>Go</code>语言开发的项目。<p>这里，我将这25种设计模式总结成了一张图<p><a href=https://static001.geekbang.org/resource/image/14/9c/1440f4bbcda682c8f5e7a599c8c51f9c.png rel=noopener target=_blank><img src=https://static001.geekbang.org/resource/image/14/9c/1440f4bbcda682c8f5e7a599c8c51f9c.png></a><p><strong>如果说设计模式解决的是具体的场景，那么 <code>SOLID</code> 原则就是我们设计应用代码时的指导方针。</strong><p><code>SOLID</code> 原则，是由<code>罗伯特·C·马丁</code>在21世纪早期引入的，包括了面向对象编程和面向对象设计的五个基本原则：<p><a href=https://static001.geekbang.org/resource/image/19/3b/19b697bbbe31450d6cc8f222491d3e3b.png rel=noopener target=_blank><img src=https://static001.geekbang.org/resource/image/19/3b/19b697bbbe31450d6cc8f222491d3e3b.png></a><p>遵循 <code>SOLID</code> 原则可以确保我们设计的代码是易维护、易扩展、易阅读的。 <code>SOLID</code> 原则同样也适用于<code>Go</code>程序设计。<p>如果你需要更详细地了解 <code>SOLID</code> 原则，可以参考下<a href=https://github.com/marmotedu/geekbang-go/blob/master/SOLID%E5%8E%9F%E5%88%99%E4%BB%8B%E7%BB%8D.md rel=noopener target=_blank> <code>SOLID</code> 原则介绍</a>这篇文章。<p>到这里，我们就学完了“编写高质量的<code>Go</code>应用”这部分内容。接下来，我们再来学习下如何高效管理<code>Go</code>项目，以及如何编写高质量的项目文档。这里面的大部分内容，之前我们都有学习过，因为它们是“如何写出优雅的<code>Go</code>项目”的重要组成部分，所以，这里我仍然会简单介绍下它们。<h2 id=高效管理项目><a class=headerlink href=#高效管理项目 title=高效管理项目></a>高效管理项目</h2><p>一个优雅的<code>Go</code>项目，还需要具备高效的项目管理特性。那么如何高效管理我们的项目呢？<p>不同团队、不同项目会采用不同的方法来管理项目，在我看来比较重要的有3点，分别是制定一个高效的开发流程、使用Makefile管理项目和将项目管理自动化。我们可以通过自动生成代码、借助工具、对接<code>CI/CD</code>系统等方法来将项目管理自动化。具体见下图：<p><a href=https://static001.geekbang.org/resource/image/61/6d/61e022c1b25dab2b0fefb407fc1c776d.png rel=noopener target=_blank><img src=https://static001.geekbang.org/resource/image/61/6d/61e022c1b25dab2b0fefb407fc1c776d.png></a><h3 id=高效的开发流程><a class=headerlink href=#高效的开发流程 title=高效的开发流程></a>高效的开发流程</h3><p>高效管理项目的第一步，就是要有一个高效的开发流程，这可以提高开发效率、减少软件维护成本。<h3 id=使用Makefile管理项目><a class=headerlink href=#使用Makefile管理项目 title=使用Makefile管理项目></a>使用Makefile管理项目</h3><p>为了更好地管理项目，除了一个高效的开发流程之外，使用<code>Makefile</code>也很重要。<code>Makefile</code>可以将项目管理的工作通过<code>Makefile</code>依赖的方式实现自动化，除了可以提高管理效率之外，还能够减少人为操作带来的失误，并统一操作方式，使项目更加规范。<p>IAM项目的所有操作均是通过<code>Makefile</code>来完成的，具体<code>Makefile</code>完成了如下操作：<pre class="line-numbers language-bash" data-language=bash><code class=language-bash>build              Build <span class="token builtin class-name">source</span> code <span class="token keyword">for</span> <span class="token function">host</span> platform.
build.multiarch    Build <span class="token builtin class-name">source</span> code <span class="token keyword">for</span> multiple platforms. See option PLATFORMS.
image              Build <span class="token function">docker</span> images <span class="token keyword">for</span> <span class="token function">host</span> arch.
image.multiarch    Build <span class="token function">docker</span> images <span class="token keyword">for</span> multiple platforms. See option PLATFORMS.
push               Build <span class="token function">docker</span> images <span class="token keyword">for</span> <span class="token function">host</span> arch and push images to registry.
push.multiarch     Build <span class="token function">docker</span> images <span class="token keyword">for</span> multiple platforms and push images to registry.
deploy             Deploy updated components to development env.
clean              Remove all files that are created by building.
lint               Check syntax and styling of go sources.
<span class="token builtin class-name">test</span>               Run unit test.
cover              Run unit <span class="token builtin class-name">test</span> and get <span class="token builtin class-name">test</span> coverage.
release            Release iam
<span class="token function">format</span>             Gofmt <span class="token punctuation">(</span>reformat<span class="token punctuation">)</span> package sources <span class="token punctuation">(</span>exclude vendor <span class="token function">dir</span> <span class="token keyword">if</span> existed<span class="token punctuation">)</span>.
verify-copyright   Verify the boilerplate headers <span class="token keyword">for</span> all files.
add-copyright      Ensures <span class="token builtin class-name">source</span> code files have copyright license headers.
gen                Generate all necessary files, such as error code files.
ca                 Generate CA files <span class="token keyword">for</span> all iam components.
<span class="token function">install</span>            Install iam system with all its components.
swagger            Generate swagger document.
serve-swagger      Serve swagger spec and docs.
dependencies       Install necessary dependencies.
tools              <span class="token function">install</span> dependent tools.
check-updates      Check outdated dependencies of the go projects.
<span class="token builtin class-name">help</span>               Show this <span class="token builtin class-name">help</span> info.<span aria-hidden=true class=line-numbers-rows><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id=自动生成代码><a class=headerlink href=#自动生成代码 title=自动生成代码></a>自动生成代码</h3><p>低代码的理念现在越来越流行。虽然低代码有很多缺点，但确实有很多优点，例如：<ul><li>自动化生成代码，减少工作量，提高工作效率。<li>代码有既定的生成规则，相比人工编写代码，准确性更高、更规范。</ul><p>目前来看，自动生成代码现在已经成为趋势，比如 <code>Kubernetes</code>项目有很多代码都是自动生成的。我认为，想写出一个优雅的<code>Go</code>项目，你也应该认真思考哪些地方的代码可以自动生成。在这门课的<code>IAM</code>项目中，就有大量的代码是自动生成的，我放在这里供你参考：<ul><li>错误码、错误码说明文档。<li>自动生成缺失的<code>doc.go</code>文件。<li>利用<code>gotests</code>工具，自动生成单元测试用例。<li>使用<code>Swagger</code>工具，自动生成<code>Swagger</code>文档。<li>使用 <code>Mock</code> 工具，自动生成接口的 <code>Mock</code> 实例。</ul><h3 id=善于借助工具><a class=headerlink href=#善于借助工具 title=善于借助工具></a>善于借助工具</h3><p>在开发<code>Go</code>项目的过程中，我们也要善于借助工具，来帮助我们完成一部分工作。利用工具可以带来很多好处：<ul><li>解放双手，提高工作效率。<li>利用工具的确定性，可以确保执行结果的一致性。例如，使用<code>golangci-lint</code>对代码进行检查，可以确保不同开发者开发的代码至少都遵循<code>golangci-lint</code>的代码检查规范。<li>有利于实现自动化，可以将工具集成到<code>CI/CD</code>流程中，触发流水线自动执行。</ul><p>那么，<code>Go</code>项目中，有哪些工具可以为我们所用呢？这里，我给你整理了一些有用的工具：<p><a href=https://static001.geekbang.org/resource/image/90/80/90ca527c2863fe642f9ab3d5b90fe980.png rel=noopener target=_blank><img src=https://static001.geekbang.org/resource/image/90/80/90ca527c2863fe642f9ab3d5b90fe980.png></a><p>所有这些工具都可以通过下面的方式安装。<pre class="line-numbers language-bash" data-language=bash><code class=language-bash><span class="token builtin class-name">cd</span> <span class="token variable">$IAM_ROOT</span>
<span class="token function">make</span> tools.install<span aria-hidden=true class=line-numbers-rows><span></span><span></span></span></code></pre><p>IAM项目使用了上面这些工具的绝大部分，用来尽可能提高整个项目的自动化程度，提高项目维护效率。<h3 id=对接CI-x2F-CD><a class=headerlink href=#对接CI-x2F-CD title=对接CI/CD></a>对接CI/CD</h3><p>代码在合并入主干时，应该有一套<code>CI/CD</code>流程来自动化地对代码进行检查、编译、单元测试等，只有通过后的代码才可以并入主干。通过<code>CI/CD</code>流程来保证代码的质量。当前比较流行的<code>CI/CD</code>工具有<code>Jenkins</code>、<code>GitLab</code>、<code>Argo</code>、<code>Github Actions</code>、<code>JenkinsX</code>等。<h2 id=编写高质量的项目文档><a class=headerlink href=#编写高质量的项目文档 title=编写高质量的项目文档></a>编写高质量的项目文档</h2><p>最后，一个优雅的项目，还应该有完善的文档。例如 <code>README.md</code>、<code>安装文档</code>、<code>开发文档</code>、<code>使用文档</code>、<code>API接口文档</code>、<code>设计文档</code>等等。<h2 id=总结><a class=headerlink href=#总结 title=总结></a>总结</h2><p>使用<code>Go</code>语言做项目开发，核心目的其实就是<strong>开发一个优雅的<code>Go</code>项目</strong>。那么如何开发一个优雅的<code>Go</code>项目呢？<code>Go</code>项目包含三大内容，即 <code>Go</code>应用、项目管理、项目文档，因此开发一个优雅的<code>Go</code>项目，其实就是<strong>编写高质量的<code>Go</code>应用</strong>、<strong>高效管理项目</strong>和<strong>编写高质量的项目文档</strong>。针对每一项，我都给出了一些实现方式，这些方式详见下图：<p><a href=https://static001.geekbang.org/resource/image/b0/cc/b051da025c897996473df44693ea4ecc.png rel=noopener target=_blank><img src=https://static001.geekbang.org/resource/image/b0/cc/b051da025c897996473df44693ea4ecc.png></a></div><footer class=post-footer><div class=post-tags><a href=/tags/Golang/ rel=tag># Golang</a><a href=/tags/IAM/ rel=tag># IAM</a><a href=/tags/%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%B3%95/ rel=tag># 设计方法</a></div><div class=post-nav><div class=post-nav-item><a title="04 | 研发流程设计" href=/post/2023-golang-practice-%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98-04-develop-step.html rel=prev> <i class="fa fa-chevron-left"></i> 04 | 研发流程设计 </a></div><div class=post-nav-item><a title="06 | 设计模式：Go设计模式" href=/post/2023-golang-practice-%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98-06-go-design-model-copy.html rel=next> 06 | 设计模式：Go设计模式 <i class="fa fa-chevron-right"></i> </a></div></div></footer></article></div></div></main><footer class=footer><div class=footer-inner><div class=copyright>© <span itemprop=copyrightYear>2024</span><span class=with-love> <i class="fa fa-heart"></i> </span><span class=author itemprop=copyrightHolder>gzwillyy</span></div></div></footer><div aria-label=返回顶部 class=back-to-top role=button><i class="fa fa-arrow-up fa-lg"></i><span>0%</span></div><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><script crossorigin=anonymous integrity=sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY= src=https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js></script><script src=/js/comments.js></script><script src=/js/utils.js></script><script src=/js/motion.js></script><script src=/js/next-boot.js></script><script crossorigin=anonymous integrity=sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc= src=https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js></script><script src=/js/third-party/search/local-search.js></script>